<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>盗梦空间 by L-C-Yang</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <b>
<body background="images/body-bg1.jpg">
        <h1><i>>>极客3+1<<</i></h1>
        <h2><i>碰撞出思维的火花</i></h2></b>
        <a href="https://github.com/L-C-Yang/L-C-Yang-" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <b> <big> <span style="color:white;"> <h2><span style="color:white;">我就是我，不一样的烟火</span></h2>
          <p>我们四人来自四个不同的专业：土机电信，构成了我们组的多样性</p>
        </br>
</br>
<!--<embed height="100" width="200" src="http://www.bz55.com/uploads/allimg/150309/139-150309101A0.jpg"/><embed>-->


<h2><span style="color:white;">创客团队</span></h2>
<ul>
<li>石嘉慧</li>
<li>柳晨阳</li>
<li>张祥毅</li>
<li>李子豪</li>
</ul>
</br>


<h2><span style="color:white;">项目计划</span></h2>
<p>项目名称：超声波避障小车</p>
<embed height="450" width="700" src="images\xiaoche.jpg"/><embed>
<p>设计原理：超声波测量前方距离，Arduino根据超声波模块接受的距离控制小车前进、后退或者左转右转。
            也就是说它有自己的“思维”方式，只要打开电源在没有人干预的情况下可以独自在房间里闲逛而不会碰到任何东西。 </p>
<p>材料准备：1、arduino 板子一个，我们使用的是 arduino duemilanove 2009 - ATMega328P，当然Arduino UNO 也可以。</p>
<embed height="200" width="300" src="images\arduino板子.jpg"/><embed>
<p>2、超声波测距模块一个</p>
<p>3、直流电机+轮胎</p>
<embed height="200" width="300" src="images\直流电机+轮胎.jpg"/><embed>
<p>4、L298N电机驱动模块一个</p>
<embed height="200" width="300" src="images\电机驱动模块.jpg"/><embed>
<p>5、万向轮 + 小车底盘 + 杜邦线 + 螺丝、螺母 + 烙铁 + 螺丝刀 + 剪刀等</p>
<p>arduino程序</p>
<p>#define DEBUG 0    // set to 1 to print to serial monitor, 0 to disable
#include <Servo.h>

Servo headservo;  // 头部舵机对象

// Constants
const int EchoPin = 2; //超声波信号输入
const int TrigPin = 3; //超声波控制信号输出

const int leftmotorpin1 = 4; // 直流电机信号输出
const int leftmotorpin2 = 5;
const int rightmotorpin1 = 6;
const int rightmotorpin2 = 7;

const int HeadServopin = 9; // 舵机信号输出 只有9或10接口可利用
const int Sharppin = 11; // 红外输入

const int maxStart = 800;  //run dec time

// Variables
int isStart = maxStart;    //启动
int currDist = 0;    // 距离
boolean running = false;

void setup() {

  Serial.begin(9600); // 开始串行监测

  //信号输入接口
  pinMode(EchoPin, INPUT);
  pinMode(Sharppin, INPUT);

  //信号输出接口
  for (int pinindex = 3; pinindex < 11; pinindex++) {
    pinMode(pinindex, OUTPUT); // set pins 3 to 10 as outputs
  }

  //舵机接口
  headservo.attach(HeadServopin);

  //启动缓冲活动头部
  headservo.write(70);
  delay(2000);
  headservo.write(20);
  delay(2000);
}

void loop() {

  if(DEBUG){
    Serial.print("running:");
    if(running){
      Serial.println("true");
    }
    else{
      Serial.println("false");
    }
  }

  if (isStart <= 0) {
    if(running){
      totalhalt();    // stop!
    }
    int findsomebody = digitalRead(Sharppin);
    if(DEBUG){
      Serial.print("findsomebody:");
      Serial.println(findsomebody);
    }
    if(findsomebody > 0) {
      isStart = maxStart;
    }
    delay(4000);
    return;
  }
  isStart--;
  delay(100);

  if(DEBUG){
    Serial.print("isStart: ");
    Serial.println(isStart);
  }

  currDist = MeasuringDistance(); //读取前端距离

  if(DEBUG){
    Serial.print("Current Distance: ");
    Serial.println(currDist);
  }

  if(currDist > 30) {
    nodanger();
  }
  else if(currDist < 15){
    backup();
    randTrun();
  }
  else {
    //whichway();
    randTrun();
  }
}

//测量距离 单位厘米
long MeasuringDistance() {
  long duration;
  //pinMode(TrigPin, OUTPUT);
  digitalWrite(TrigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(TrigPin, HIGH);
  delayMicroseconds(5);
  digitalWrite(TrigPin, LOW);

  //pinMode(EchoPin, INPUT);
  duration = pulseIn(EchoPin, HIGH);

  return duration / 29 / 2;
}

// 前进
void nodanger() {
  running = true;
  digitalWrite(leftmotorpin1, LOW);
  digitalWrite(leftmotorpin2, HIGH);
  digitalWrite(rightmotorpin1, LOW);
  digitalWrite(rightmotorpin2, HIGH);
  return;
}

//后退
void backup() {
  running = true;
  digitalWrite(leftmotorpin1, HIGH);
  digitalWrite(leftmotorpin2, LOW);
  digitalWrite(rightmotorpin1, HIGH);
  digitalWrite(rightmotorpin2, LOW);
  delay(1000);
}

//选择路线
void whichway() {
  running = true;
  totalhalt();    // first stop!

  headservo.write(20);
  delay(1000);
  int lDist = MeasuringDistance();   // check left distance
  totalhalt();      // 恢复探测头

  headservo.write(120);  // turn the servo right
  delay(1000);
  int rDist = MeasuringDistance();   // check right distance
  totalhalt();      // 恢复探测头

  if(lDist < rDist) {
    body_lturn();
  }
  else{
    body_rturn();
  }
  return;
}

//重新机械调整到初始状态
void totalhalt() {
  digitalWrite(leftmotorpin1, HIGH);
  digitalWrite(leftmotorpin2, HIGH);
  digitalWrite(rightmotorpin1, HIGH);
  digitalWrite(rightmotorpin2, HIGH);
  headservo.write(70);  //  set servo to face forward
  running = false;
  return;
  delay(1000);
}

//左转
void body_lturn() {
  running = true;
  digitalWrite(leftmotorpin1, LOW);
  digitalWrite(leftmotorpin2, HIGH);
  digitalWrite(rightmotorpin1, HIGH);
  digitalWrite(rightmotorpin2, LOW);
  delay(1500);
  totalhalt();
}

//右转
void body_rturn() {
  running = true;
  digitalWrite(leftmotorpin1, HIGH);
  digitalWrite(leftmotorpin2, LOW);
  digitalWrite(rightmotorpin1, LOW);
  digitalWrite(rightmotorpin2, HIGH);
  delay(1500);
  totalhalt();
}

void randTrun(){
  long randNumber;
  randomSeed(analogRead(0));
  randNumber = random(0, 10);
  if(randNumber > 5) {
    body_rturn();
  }
  else
  {
    body_lturn();
  }
}
</p>
</br>
</br>
</br>


<h2><span style="color:white;">座右铭</span></h2>
<p>
纸上得来终觉浅，绝知此事要躬行</p>
</br>



<h2><span style="color:white;">常用链接 </span></h2>
<ul>
<li><a href="https://github.com/">
<img height="100" width="100" border="0" src="images/github.jpg" /></a>
</li>

<li><a href="http://www.w3school.com.cn/">HTML教程</a></li>
<li><a href="http://swjtu-maker.github.io/codes2things/course/2016/">codes2things课程</a></li>
</ul> </span> </big> </b>
</br>
</br>

        </section>

        <aside id="sidebar">
          <a href="https://github.com/L-C-Yang/L-C-Yang-/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/L-C-Yang/L-C-Yang-/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>




        </aside>
      </div>
    </div>


  </body>
</html>
